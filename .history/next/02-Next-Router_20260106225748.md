# Next.js 라우팅

- [용어](#용어)
- [App 라우터](#app-라우터)
- [라우트 정의](#라우트-정의)
- [페이지와 레이아웃](#페이지와-레이아웃)
  - [메타데이터](#메타데이터)
- [페이지 이동](#페이지-이동)
- [동적 라우트](#동적-라우트)




<br />
<br />




## 용어

![App 라우터 구조](../src/images/nextjs-router-structure.png)




<br />
<br />




## App 라우터

- 파일 시스템 기반 라우터

  - `app` 폴더 하위의 폴더명이 `URL`의 경로가 됨

- `page` 라우터에서는 지원하지 않는 공유 레이아웃, 중첩 라우팅, 로딩 상태, 에러 처리 등을 지원

  - `layout.tsx` : 동일 폴더와 하위 폴더 페이지의 레이아웃을 정의

  - `page.tsx` : 페이지 UI

  - `loading.tsx` : 페이지 로딩 중에 표시되는 UI

  - `not-found.tsx` : 404 오류 페이지

  - `error.tsx` : 페이지의 오류를 처리

  - `global-error.tsx` : Root Layout에서 발생하는 오류를 처리

  - `route.ts` : API 엔드포인트 정의




<br />
<br />




## 라우트 정의

![라우트 정의](../src/images/nextjs-route.png)

- `app` 라우터에 폴더를 생성하면, 해당 폴더명이 `URL` 경로가 된다.

- `page.tsx` 파일이 있으면, 해당 경로로 접근했을 때 `page.tsx` 파일을 렌더링해서 보여준다.

  - `page.tsx` 파일이 없는 디렉토리는 라우팅 되지 않는다.

- 생성한 폴더 하위에 라우팅 규칙과 관련된 특수 파일, `CSS`, 이미지 등의 파일을 생성할 수 있다.




<br />
<br />




## 페이지와 레이아웃

![App Router](../src/images/app-router-1.png)

- 보통은 `children`에 해당 세그먼트의 `page.tsx`가 렌더링이 되는데, 
  
  - 세그먼트 내에 `layout.tsx`가 있으면 `layout.tsx`가 먼저 렌더링된다.

![App Router](../src/images/app-router-2.png)

- 해당 세그먼트의 `layout.tsx`는 해당 세그먼트 안에서만 사용할 공통 레이아웃이 된다.

  - `layout.tsx`에서는 해당 세그먼트 안에 있는 세그먼트들의 `page.tsx`를 `children`으로 전달 받아 렌더링한다.

![App Router](../src/images/app-router-3.png)

<br />

### 메타데이터

- `layout`, `page`에서 `metadata` 변수나 `generateMetadata` 함수를 `export` 하면 메타데이터 정의 가능

- `metadata` : 정적인 메타데이터 출력

  ![App Metadata](../src/images/app-metadata-1.png)

- `generatrMetadata` : 동적인 메타데이터 출력

  ![App Metadata](../src/images/app-metadata-2.png)

- 경로 히스토리도 깔끔하게 볼 수 있다.

  ![App Metadata](../src/images/app-metadata-3.png)




<br />
<br />




## 페이지 이동

### Link 컴포넌트

- `<a>` 태그는 전체 페이지를 새로 요청해 앱을 다시 시작한다.

- `Link` 컴포넌트는 새로고침 없이 필요한 부분만 전환해 빠르고 자연스러운 이동을 제공한다.

```tsx
import Link from "next/link";
...
<li><Link href="/" className={`hover:underline`}>Home</Link></li>
<li><Link href="/about" className={`hover:underline`}>About</Link></li>
<li><Link href="/posts" className={`hover:underline`}>게시판</Link></li>
<li><Link href="/user/login" className={`hover:underline`}>로그인</Link></li>
<li><Link href="/user/signup" className={`hover:underline`}>회원가입</Link></li>
...
```

<br />

### usePathname

- 현재 `URL` 경로를 가져오는 훅

- 활성 링크 스타일링 등에 활용

- `'use client'` 지시어가 있는 클라이언트 컴포넌트에서만 사용 가능

  - `usePathname` 훅은 클라이언트 컴포넌트에서만 사용 가능하다.
  
  - 지시어를 정의하면 서버 컴포넌트에서 클라이언트 컴포넌트로 동작하게 된다.

![usePathname 훅 사용](../src/images/nextjs-usePathname-1.png)

- 경로 일치시 클래스를 추가하여 활성 링크 스타일을 적용할 수 있다.

![usePathname 훅 사용](../src/images/nextjs-usePathname-2.png)

- 경로 일치시 클래스를 추가하여 활성 링크 스타일을 적용할 수 있다.




<br />
<br />




## 동적 라우트

- `[folder]`

  - 동적 세그먼트

  - `URL`의 해당 위치에 어떤 값이 오더라도 매칭됨

  ![App Router](../src/images/app-router-4.png)

```tsx
export default async function PostInfo({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  return (
    <h1>{ id }번 게시물 상세 조회</h1>
  );
}
```

- 세그먼트를 동적으로 제어하기 위해 값을 꺼낼 때는 `params` `prop`을 사용한다.

- `params`는 `Promise` 형태로 전달되며, 이를 사용하려면 `async/await` 패턴을 사용해야 한다.

![App Router](../src/images/app-router-5.png)

```tsx
export async function generateMetadata({ params }: { params: Promise<{ id: string }> }): Promise<Metadata> {
  const { id } = await params;

  // API 서버 호출 필요
  const data = {
    title: `${ id }번 게시물`,
    content: '게시판 이용 수칙입니다.',
  };

  return {
    title: data.title,
    description: data.content,
  };
}
```

- `generateMetadata` 함수에서도 `params`를 가져와서 사용할 수 있다.