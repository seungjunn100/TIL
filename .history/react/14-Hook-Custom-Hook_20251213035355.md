# Custom Hook

- [Custom Hook](#custom-hook-1)
- [사용 예시](#사용-예시)
  - [Counter 예제](#counter-예제)
  - [Fetch 예제](#fetch-예제)




<br />
<br />




## Custom Hook

리액트의 기본 훅(`useState`, `useEffect` 등)을 이용해 특정 로직을 여러 컴포넌트에서 재사용 가능하게 만드는 커스텀 훅

- 함수 이름은 반드시 `use*` 형태로 작성해야 한다.

- 리액트의 기본 훅은 일반 함수에서 사용할 수 없다.
  
  - 기본 훅을 활용하려면 커스텀 훅으로 작성해야 한다.

- UI와 비즈니스 로직을 분리하여 컴포넌트를 단순화 할 수 있다.

- 상태, 효과 관련 로직을 묶어서 컴포넌트 단위의 유지보수가 용이하다.

<br />

## 사용 예시

### Counter 예제

#### Counter 컴포넌트

```tsx
import Button from "@/components/Button";
import { useState } from "react";

interface CounterProps {
  children: string;
}

function Counter({ children }: CounterProps) {
  console.log('\tCounter 호출됨.');

  const initCount = Number(children);

  const [ count, setCount ] = useState(initCount);

  const [ step, setStep ] = useState(1);

  // 카운트 감소
  const handleDown = () => {
    setCount(count - step);
  };

  // 카운트 증가
  const handleUp = () => {
    setCount(count + step);
  };

  // 카운트 초기화
  const handleReset = () => {
    setCount(initCount);
  };

  return (
    <div id="counter">
      <label htmlFor="step">증감치</label>
      <input id="step" type="number" value={ step } onChange={ (e) => setStep(Number(e.target.value)) } />
      <Button bgColor="red" color="black" onClick={ handleDown }>-_-</Button>
      <Button bgColor="gray" onClick={ handleReset }>0_0</Button>
      <Button onClick={ handleUp }>+_+</Button>
      <span>{ count }</span>
    </div>
  );
}

export default Counter;
```

- 상태 관련 로직을 따로 분리해서 작업하여 용이하게 관리할 수 있다.

<br />

#### useCounter 커스텀 훅

```tsx
import { useState } from "react";

function useCounter(initCount: number) {
  const [ count, setCount ] = useState(initCount);
  const [ step, setStep ] = useState(1);

  const handleStepChange = (newStep: number) => {
    setStep(newStep);
  };

  // 카운트 감소
  const handleDown = () => {
    setCount(count - step);
  };

  // 카운트 증가
  const handleUp = () => {
    setCount(count + step);
  };

  // 카운트 초기화
  const handleReset = () => {
    setCount(initCount);
  };

  return { count, step, handleStepChange, handleDown, handleUp, handleReset };
}

export default useCounter;
```

- 상태 관련 로직을 커스텀 훅에 모아두었다.

<br />

#### useCounter 커스텀 훅을 사용하는 Counter 컴포넌트

```tsx
import Button from "@/components/Button";
import useCounter from "@/hooks/useCounter";

interface CounterProps {
  children: string;
}

function Counter({ children }: CounterProps) {
  console.log('\tCounter 호출됨.');

  const initCount = Number(children);

  const { 
    count, 
    step, 
    handleStepChange, 
    handleDown, 
    handleUp, 
    handleReset 
  } = useCounter(initCount);

  return (
    <div id="counter">
      <label htmlFor="step">증감치</label>
      <input id="step" type="number" value={ step } onChange={ (e) => handleStepChange(Number(e.target.value)) } />
      <Button bgColor="red" color="black" onClick={ handleDown }>-_-</Button>
      <Button bgColor="gray" onClick={ handleReset }>0_0</Button>
      <Button onClick={ handleUp }>+_+</Button>
      <span>{ count }</span>
    </div>
  );
}

export default Counter;
```

- `Counter` 컴포넌트는 커스텀 훅을 사용하여 `props`를 전달받아 UI 작업에만 집중할 수 있다.




<br />
<br />




### Fetch 예제

![Custom-Fetch-1](../src/images/custom-fetch-1.png)

- 할일 목록과 할일 상세 조회 컴포넌트를 만들고, 
  
  - `useFetch` 커스텀 훅을 만들어 각 컴포넌트에서 사용
  
  - 할일 목록에서 링크 클릭 시 해당 할일의 상세 조회를 렌더링 하는 작업

<br />

#### 공통 타입 설정

```typescript
// Item 타입
export interface Todo {
  _id: number;
  title: string;
  done: boolean;
  content: string;
  createdAt: string;
  updatedAt: string;
}

// 상세 조회 결과 타입
export interface TodoInfoRes {
  ok: 1;
  item: Todo;
}

// 서버의 목록 조회 결과 타입
export interface TodoListRes {
  ok: 1;
  items: Todo[];
}

// 서버에서 에러를 응답할 경우 타입
export interface ErrorRes {
  ok: 0;
  message: string;
}

// 서버의 응답
export type ResData<T extends TodoListRes | TodoInfoRes> = T | ErrorRes;
```

<br />

#### useFetch 커스텀 훅

```typescript
import type { ErrorRes, ResData, TodoListRes, TodoInfoRes } from "@/types/todo";
import { useEffect, useState } from "react";

const API_SERVER = 'https://fesp-api.koyeb.app/todo';

interface FetchParams {
  url: string;
  method?: 'GET' | 'POST';
}

function useFetch<T extends TodoListRes | TodoInfoRes>(fetchParams: FetchParams) {
  // Todo 목록을 저장할 상태 (초기값: null)
  const [ data, setData ] = useState<T | null>(null);
  // 에러 메세지를 저장할 상태 (초기값: null)
  const [ error, setError ] = useState<ErrorRes | null>(null);
  // 로딩 상태를 저장 (초기값: true)
  const [ loading, setLoading ] = useState(true);

  const requestFetch = async (params: FetchParams) => {
    try{
      setLoading(true);

      const res = await fetch(API_SERVER + params.url);
      const jsonRes: ResData<T> = await res.json();

      if (jsonRes.ok === 1) {
        setData(jsonRes);
        setError(null);
      } else { 
        throw new Error(jsonRes.message);
      }
    }catch(err){
      setError(err as ErrorRes);
      setData(null);
    }finally{
      setLoading(false);
    }
  };

  useEffect(() => {
    requestFetch(fetchParams);
  }, []);

  return { data, error, loading };
}

export default useFetch;
```

- `useFetch` 커스텀 훅은 할일 목록 컴포넌트, 할일 상세 조회 컴포넌트에서 공통적으로 서버에 데이터를 요청하여 응답받은 데이터에 따라 렌더링되는 로직을 구현하였다.

- 컴포넌트가 초기값으로 마운트 된 후에 `useEffect` 훅이 실행된다.

- `requestFetch` 함수가 실행되며, 서버에 데이터를 요청한다.

- 응답받은 데이터에 의해 상태 관리가 이루어지고,

  - 갱신된 상태값을 객체로 반환하고, 리렌더링이 이루어진다.

##### 체크 포인트

- `fetch` 함수는 `Promise` 객체를 반환하므로, 비동기 결과를 처리하기 위해 `async/await`를 사용하였다.

- 응답 데이터의 에러는 네트워크 통신 실패가 아니다.

- 네트워크 에러는 서버에 요청 자체가 실패하는 것이다.

- 응답 데이터의 에러를 `catch`문에서 통합해서 처리해주면 유지보수에 용이하다.

<br />

#### 할일 목록 컴포넌트

```tsx
import useFetch from "@/hooks/useFetch";
import type { TodoListRes } from "@/types/todo";
import { CircleLoader } from "react-spinners";

function TodoList() {
  const { data, error, loading } = useFetch<TodoListRes>({ url: '/todolist' });

  const list = data?.items.map(item => (
    <li key={ item._id }>
      <a href={`/${ item._id }`}>{ item.title }</a>
    </li>
  ));

  return (
    <>
      <h1>10 customHook - useFatch, useAxios 커스텀 훅 사용</h1>
      <h2>할일 목록</h2>

      { loading && 
        <CircleLoader
          color={ '#333' }
          loading={loading}
          size={100}
          aria-label="Loading Spinner"
          data-testid="loader"
        />
      }
      
      { error && <p style={{ color: 'red' }}>{ error.message }</p> } 
          
      <ul>
        { data && list }
      </ul>
    </>
  );
}

export default TodoList;
```

- 리스트의 링크에 해당 `_id`값을 링크로 전달하여, 클릭시 해당 할일 상세 조회를 렌더링 한다.

- 할일 목록 컴포넌트는 전달받은 상태값에 따라 렌더링을 한다.

##### 체크 포인트

- 리스트 렌더링은 `key`값을 지정해줘야 서로 다른 리스트로 인식될 수 있게 한다.

- `react-spinners` 라이브러리를 사용하여 로딩중 모션을 간편하게 사용

<br />

#### 할일 상세 조회 컴포넌트

```tsx
import useFetch from "@/hooks/useFetch";
import type { TodoInfoRes } from "@/types/todo";

function TodoInfo() {

  const id = window.location.pathname.split('/').pop();

  const { data, error, loading } = useFetch<TodoInfoRes>({ url: `/todolist/${id}` });

  return (
    <>
      <h1>10 customHook - useFatch, useAxios 커스텀 훅 사용</h1>
      <h2>할일 상세 조회</h2>

      { loading && <p>로딩중...</p> }

      { error && <p style={{ color: 'red' }}>{ error.message }</p> }

      { data && 
        <div>
          <p>제목: { data.item.title }</p>
          <p>내용: { data.item.content }</p>
          <p>상태: { data.item.done ? '완료' : '미완료' }</p>
          <p>작성일: { data.item.createdAt }</p>
          <p>수정일: { data.item.updatedAt }</p>
        </div>
      }

      <a href="/">목록</a>
    </>
  );
}

export default TodoInfo;
```

- 할일 목록 컴포넌트에서 할일 목록 리스트중 하나의 링크 클릭시 주소에 남은 `_id` 값을 추출해서 해당 할일 리스트의 상세를 렌더링 한다.

- 할일 상세 조회 컴포넌트는 전달받은 상태값에 따라 렌더링을 한다.

##### 체크 포인트

- `window.location.pathname` : 해당 사이트 주소의 `경로(/2)`를 추출할 수 있다.

- `.split('/')` : 해당 경로를 `/`로 나누어 배열로 만든다. `['', 2]`

- `.pop()` : 배열의 마지막 값을 추출한다. `2`